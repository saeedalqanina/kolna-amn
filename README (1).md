تطوير كلنا أمن - Kolna Amn Upgrade

نظرة عامة

نظام ذكي لتصنيف وتحليل الحوادث الأمنية في السعودية باستخدام Qwen API. تم تطوير النظام وفقاً لملاحظات الأستاذ.

المميزات المضافة

1. سكريبت اختبار النموذج
- ملف test_model.py لاختبار النموذج والتأكد من عمله بشكل صحيح
- اختبارات للتصنيف، اكتشاف المكررات، واكتشاف الموقع

2. واجهتان منفصلتان
- واجهة الإدخال: لإدخال البلاغات الجديدة مع الإحداثيات والوقت
- واجهة النتائج: لعرض جميع البلاغات مع التصنيف والمكررات

3. أيقونة الوقت
- تم إضافة أيقونة لعرض وقت الحادث في جميع النتائج

4. اكتشاف الموقع حسب المنطقة (غير ثابت)
- النظام يكتشف الموقع من النص (المدينة أو المنطقة)
- إضافة إزاحة عشوائية صغيرة للإحداثيات لمحاكاة المنطقة داخل المدينة
- دعم أسماء المناطق الشائعة (العليا، الزهراء، العزيزية، إلخ)

5. إضافة الإحداثيات والوقت
- جميع البلاغات تُخزن مع:
  - خط العرض (Latitude)
  - خط الطول (Longitude)
  - الطابع الزمني (Timestamp)

6. اكتشاف الحوادث المكررة
- يتم تحديد الحادث كـ "مكرر" إذا:
  - وقع في نفس المنطقة (نطاق 200 متر)
  - وقع خلال 20 دقيقة من حادث آخر
- يتم عرض الحوادث المكررة مع المسافة والفرق الزمني

كيفية الاستخدام

1. تشغيل السيرفر الخلفي

```bash
python backend.py
```

السيرفر سيعمل على: `http://localhost:5000`

2. فتح الواجهة الأمامية

افتح ملف `frontend.html` في المتصفح

3. اختبار النموذج

```bash
python test_model.py
```

هيكل الملفات

```
usman/
├── backend.py              # السيرفر الخلفي (Flask)
├── frontend.html           # الواجهة الأمامية (HTML/CSS/JS)
├── test_model.py          # سكريبت الاختبار
├── Dataset (1).xlsx       # قاعدة البيانات
└── README.md              # هذا الملف
```

API Endpoints

POST /api/analyze
تحليل بلاغ جديد

**Request:**
```json
{
  "text": "نص البلاغ",
  "latitude": 24.7136,
  "longitude": 46.6753,
  "timestamp": "2024-01-01T12:00:00"
}
```

**Response:**
```json
{
  "text": "نص البلاغ",
  "timestamp": "2024-01-01T12:00:00",
  "location": {
    "city": "الرياض",
    "area": "العليا",
    "latitude": 24.7136,
    "longitude": 46.6753
  },
  "classification": {
    "severity": "عالي",
    "confidence": 0.85,
    "reasoning": "سبب التصنيف",
    "is_duplicate": false,
    "duplicate_count": 0
  },
  "duplicate_incidents": [],
  "similar_incidents": []
}
```

GET /api/health
فحص حالة السيرفر

GET /api/incidents
الحصول على جميع البلاغات المخزنة

معايير التصنيف

- **عالي**: اختطاف، قتل، إطلاق نار، حريق، انفجار
- **متوسط**: مشاجرة، سرقة، حوادث مرورية
- **عادي**: سيارة متوقفة، ضوضاء، شكوى عامة

اكتشاف المكررات

- **نطاق المسافة**: 200 متر
- **نطاق الزمن**: 20 دقيقة
- يتم عرض الحوادث المكررة مع:
  - المسافة بالأمتار
  - الفارق الزمني بالدقائق

ملاحظات تقنية

- يستخدم النظام Qwen API للتصنيف الذكي
- في حالة فشل API، يتم استخدام التصنيف القائم على القواعد
- يتم تخزين آخر 1000 حادث في الذاكرة (في الإنتاج، استخدم قاعدة بيانات)
- دعم RTL (من اليمين لليسار) للعربية

المتطلبات

```bash
pip install flask flask-cors pandas openpyxl openai requests
```

التطوير المستقبلي

- [ ] استخدام قاعدة بيانات حقيقية بدلاً من الذاكرة
- [ ] إضافة خريطة تفاعلية لعرض الحوادث
- [ ] تحسين دقة اكتشاف الموقع
- [ ] إضافة تصدير البيانات
- [ ] إضافة إحصائيات وتحليلات

الدعم

لأي استفسارات أو مشاكل، يرجى التواصل مع فريق التطوير.

---

تم التطوير وفقاً لملاحظات الأستاذ
